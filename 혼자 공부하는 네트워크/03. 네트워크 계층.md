# 🌐 네트워크 계층(Network Layer) 정리

## ✨ 학습 목표
- 네트워크 계층의 주요 프로토콜을 이해한다
- IP 주소의 개념, 구조, 할당 방식을 이해한다
- 라우터의 역할과 라우팅 개념을 이해한다
- ARP가 왜 필요하며 어떻게 동작하는지 이해한다

---

## 01. LAN을 넘어서는 네트워크 계층

### LAN(Local Area Network)
- 가정, 기업, 학교처럼 **지리적으로 가까운 범위**의 네트워크
- 같은 LAN 내부에서는 브로드캐스트가 가능
- MAC 주소 기반 통신이 가능

👉 문제는 **LAN을 넘어 다른 네트워크와 통신할 때** 발생한다.

---

## 02. 프로토콜이란?
> **네트워크에서 데이터를 주고받기 위한 규칙들의 묶음**

프로토콜이 정하는 것:
- 누가 누구에게 보내는가
- 데이터 형식은 무엇인가
- 순서가 틀리면 어떻게 처리하는가
- 중간에 데이터가 유실되면 어떻게 하는가

👉 네트워크 통신이 가능해지는 최소한의 약속

---

## 03. 데이터 링크 계층의 한계

### 1️⃣ 다른 네트워크까지의 경로를 알 수 없음
- 물리 계층 / 데이터 링크 계층은 기본적으로 **LAN 내부 통신** 담당
- 다른 네트워크로 가는 경로를 판단할 수 없음

#### 라우팅(Routing)
> **패킷이 목적지까지 가기 위한 최적의 경로를 결정하는 것**

- 허브, 스위치 ❌ (라우팅 불가)
- **라우터 ⭕ (네트워크 계층 장비)**

👉 라우팅은 네트워크 계층의 역할

---

### 2️⃣ MAC 주소만으로는 위치를 표현할 수 없음
- MAC 주소는 전 세계적으로 유일하지만 **위치 정보가 없음**
- 모든 호스트가 모든 MAC 주소를 미리 아는 것은 현실적으로 불가능

#### 주소의 성격 비교

| 구분 | MAC 주소 | IP 주소 |
|---|---|---|
| 성격 | 물리 주소 | 논리 주소 |
| 의미 | 장비 자체 식별 | 네트워크 상 위치 |
| 범위 | 같은 LAN | 네트워크 전체 |
| 변경 가능성 | 거의 없음 | 변경 가능 |

👉 **라우팅에는 IP 주소가 필요**

---

## 04. 인터넷 프로토콜(IP)

### IP란?
> **네트워크 계층에서 송수신 대상을 지정하고, 다른 네트워크로 패킷을 전달하기 위한 핵심 프로토콜**

- IPv4
- IPv6

---

### IP 주소의 형태 (IPv4)
- 32비트 주소
- 8비트씩 나눈 단위를 **옥텟(Octet)** 이라고 함
- 점(.)으로 구분
```
192.168.1.1
```
---

### IP의 주요 기능

#### 1️⃣ IP 주소 지정
- 송신지 IP 주소
- 수신지 IP 주소
- 통신 대상을 명확히 지정

#### 2️⃣ IP 단편화(Fragmentation)
- 전송하려는 패킷이 **MTU(Maximum Transmission Unit)** 보다 클 경우
- 여러 개의 작은 패킷으로 나누어 전송

> MTU: 한 번에 전송 가능한 IP 패킷의 최대 크기

---

## 05. IPv4

### IPv4 패킷 헤더 주요 필드

#### 🔹 TTL (Time To Live)
- 패킷이 라우터를 하나 지날 때마다 1 감소
- TTL이 0이 되면 패킷 폐기

> 홉(Hop): 패킷이 라우터 또는 호스트를 한 번 거치는 것  
👉 라우팅 루프 방지 목적

---

#### 🔹 프로토콜 필드
- 상위 계층 프로토콜을 나타냄
  - TCP
  - UDP
  - ICMP 등

---

#### 🔹 IP 단편화 관련 필드
- **식별자**: 같은 원본 패킷임을 구분
- **플래그**
  - 예약 비트: 항상 0
  - DF(Don’t Fragment):  
    - 1 → 단편화 금지  
    - 0 → 단편화 허용
  - MF(More Fragment):  
    - 1 → 뒤에 더 있음  
    - 0 → 마지막 조각
- **단편화 오프셋**
  - 원본 데이터에서의 위치 정보

---

## 06. IPv6

### IPv6 등장 배경
- IPv4 주소 수: 약 **43억 개**
- 전 세계 인구 + IoT 증가 → 주소 고갈 문제

---

### IPv6 특징
- 주소 길이: **128비트 (16바이트)**
- 라우터에서 단편화 수행 ❌
- 헤더 구조 단순화

---

### IPv6 패킷 헤더 주요 필드
- 다음 헤더(Next Header): 상위 계층 프로토콜 또는 확장 헤더
- 홉 제한(Hop Limit): IPv4의 TTL과 동일한 역할
- 송신지 IP 주소
- 수신지 IP 주소

---

## 07. ARP (Address Resolution Protocol)

### ARP가 필요한 이유
- IP 주소는 알고 있지만
- **MAC 주소를 모르는 상황**이 발생함

> IP는 라우팅을 위한 주소  
> MAC은 실제 프레임 전송을 위한 주소

---

### ARP의 역할
> **IP 주소 → MAC 주소 변환**

- 동일한 네트워크(LAN) 내부에서만 동작

---

### ARP 동작 과정

#### 1️⃣ ARP 요청 (Broadcast)
- A가 네트워크 내 모든 호스트에게 브로드캐스트
- “이 IP 주소 주인 누구야?”

---

#### 2️⃣ ARP 응답 (Unicast)
- 해당 IP를 가진 B만 응답
- “그 IP는 나야, MAC 주소는 이거야”

- ---

#### 3️⃣ ARP 테이블 갱신
- IP ↔ MAC 매핑 정보 저장
- 일정 시간이 지나면 자동 삭제 (캐시)

---

### ARP 테이블
- 모든 호스트가 유지
- IP 주소와 MAC 주소의 대응표
- 필요 시 다시 ARP 요청

---

## 🔑 핵심 흐름 요약

1. MAC 주소만으로는 네트워크 전체 통신 불가능
2. → 위치 개념이 있는 IP 주소 필요
3. → IP 주소 기반으로 라우팅 수행
4. → 실제 전송에는 MAC 주소 필요
5. → ARP가 IP → MAC 변환 수행

---

## 📌 한 문장 요약

> **네트워크 계층은 IP 주소를 이용해 “어디로 보낼지”를 결정하고,  
라우터는 그 결정을 바탕으로 패킷을 다음 네트워크로 전달하며,  
ARP는 실제 전송을 위해 IP 주소를 MAC 주소로 변환한다.**
